<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2709176-10"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2709176-10', { 'anonymize_ip': true }); </script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>5.0 Cisco Vulnerability and PSIRTS Dashboard | Jamie Sullivan’s Blog</title><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="5.0 Cisco Vulnerability and PSIRTS Dashboard" /><meta property="og:locale" content="en_US" /><meta name="description" content="Network automation, Data Center, Python, Infrastructure-as-code" /><meta property="og:description" content="Network automation, Data Center, Python, Infrastructure-as-code" /><link rel="canonical" href="http://localhost:4000/docs/grafana/OpenVuln-API/" /><meta property="og:url" content="http://localhost:4000/docs/grafana/OpenVuln-API/" /><meta property="og:site_name" content="Jamie Sullivan’s Blog" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="5.0 Cisco Vulnerability and PSIRTS Dashboard" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Network automation, Data Center, Python, Infrastructure-as-code","headline":"5.0 Cisco Vulnerability and PSIRTS Dashboard","url":"http://localhost:4000/docs/grafana/OpenVuln-API/"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> Jamie Sullivan's Blog </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/NetDevOps-Other" class="nav-list-link">NetDevOps - all other articles</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/NetDevOps-Other/Intersight-automation-of-delivery-documentation/" class="nav-list-link">Intersight - Automation of Delivery Documentation</a><li class="nav-list-item "><a href="http://localhost:4000/docs/NetDevOps-Other/aci-configuration-importer/" class="nav-list-link">Nexus to ACI Configuration Importer</a><li class="nav-list-item "><a href="http://localhost:4000/docs/NetDevOps-Other/meraki-as-built-generator/" class="nav-list-link">Meraki As-Built Generator</a><li class="nav-list-item "><a href="http://localhost:4000/docs/NetDevOps-Other/provisioning-ucs-from-spreadsheet/" class="nav-list-link">Provisioning UCS from Spreadsheet</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/infrastructure-as-code" class="nav-list-link">Infrastructure as Code</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/infrastructure-as-code/ansible-dcnm/" class="nav-list-link">1. Deploying an EVPN and VXLAN Fabric with Ansible</a></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/grafana" class="nav-list-link">Grafana Django and Cisco APIs Dashboard</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/grafana/Introduction/" class="nav-list-link">1. Introduction</a><li class="nav-list-item "><a href="http://localhost:4000/docs/grafana/meraki/" class="nav-list-link">2. Building a Meraki Dashboard</a><li class="nav-list-item "><a href="http://localhost:4000/docs/grafana/dcnm-lab/" class="nav-list-link">3.1 DCNM Lab Build</a><li class="nav-list-item "><a href="http://localhost:4000/docs/grafana/dcnm-dashboard/" class="nav-list-link">3.2 Building a DCNM Dashboard</a><li class="nav-list-item "><a href="http://localhost:4000/docs/grafana/SDWAN-Lab-Build/" class="nav-list-link">4.1 Cisco SDWAN Lab Build</a><li class="nav-list-item "><a href="http://localhost:4000/docs/grafana/Cisco-SDWAN-Grafana/" class="nav-list-link">4.2 Cisco SDWAN and vManage Dashboard</a><li class="nav-list-item active"><a href="http://localhost:4000/docs/grafana/OpenVuln-API/" class="nav-list-link active">5.0 Cisco Vulnerability and PSIRTS Dashboard</a><li class="nav-list-item "><a href="http://localhost:4000/docs/grafana/DNAC-Grafana/" class="nav-list-link">6.0 Cisco DNAC Dashboard</a><li class="nav-list-item "><a href="http://localhost:4000/docs/grafana/ACI-Dashboard/" class="nav-list-link">7.0 Cisco ACI Dashboard</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/SRE" class="nav-list-link">SRE - Learnings and Notes</a><ul class="nav-list "></ul><li class="nav-list-item"><a href="http://localhost:4000/docs/observability/dotnet-containers" class="nav-list-link">Part 1 - Instrumenting a dotnet6 container with appdynamics</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://www.linkedin.com/in/jamie-sullivan-71575421/" class="site-button" > Contact me on LinkedIn </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/grafana">Grafana Django and Cisco APIs Dashboard</a><li class="breadcrumb-nav-list-item"><span>5.0 Cisco Vulnerability and PSIRTS Dashboard</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="51-introduction"> <a href="#51-introduction" class="anchor-heading" aria-labelledby="51-introduction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.1 Introduction</h1><p>In part five of the series on cross domain visualisations and dashboards with Grafana, we experiment with the OpenVuln API.</p><blockquote><p>The Cisco Product Security Incident Response Team (PSIRT) openVuln API is a RESTful API that allows customers to obtain Cisco Security Vulnerability information in different machine-consumable formats. APIs are important for customers because they allow their technical staff and programmers to build tools that help them do their job more effectively (in this case, to keep up with security vulnerability information).</p></blockquote><p>By the end of this article we’ll have created a dashboard that provides a single, aggregated view of:</p><ul><li>Advisories by product family<li>PSIRT severity rating and when they were released<li>A detailed table with links to the PSIRT URL<li>Created alerting and notifications when new PSIRTs are detected</ul><p><img src="https://github.com/j-sulliman/j-sulliman.github.io/blob/master/images/OpenVuln_Dash.png?raw=true" alt="OpenVuln Dashboard" /></p><h1 id="52-references"> <a href="#52-references" class="anchor-heading" aria-labelledby="52-references"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.2 References</h1><ul><li><a href="https://developer.cisco.com/psirt/">OpenVuln API on DevNet</a><li><a href="https://developer.cisco.com/docs/psirt/">API Reference Guide</a><li><a href="https://github.com/CiscoPSIRT/openVulnAPI">OpenVuln GitHub Repo</a><li><a href="https://grafana.com/docs/grafana/latest/alerting/create-alerts/">Grafana Alerts</a></ul><hr /><h1 id="53-generating-an-api-key-and-secret-from-the-api-console"> <a href="#53-generating-an-api-key-and-secret-from-the-api-console" class="anchor-heading" aria-labelledby="53-generating-an-api-key-and-secret-from-the-api-console"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.3 Generating an API Key and Secret from the API Console</h1><p>Following the <strong>Accessing the API</strong> section of the API reference guide, register a new application and select the OpenVuln API. Once registered, you’ll have an API key and secret that can be used to authenticate your requests: <img src="https://github.com/j-sulliman/j-sulliman.github.io/blob/master/images/OpenVuln_App_and_Key.png?raw=true" alt="API Console" /></p><hr /><h1 id="54-create-our-openvuln-app-in-django"> <a href="#54-create-our-openvuln-app-in-django" class="anchor-heading" aria-labelledby="54-create-our-openvuln-app-in-django"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.4 Create our OpenVuln App in Django</h1><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>venv<span class="o">)</span> % python manage.py startapp openvuln
</code></pre></div></div><p>Running the above will create the openvuln directory structure.</p><p>If you’ve followed along with previous articles, your cisco_grafana django directory will look similar to:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">.</span>
├── apps
│   ├── dcnm_api.py
│   ├── meraki_api.py
│   └── sdwan_api.py
├── cisco_grafana
│   ├── __init__.py
│   ├── asgi.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── db.sqlite3
├── dcnm
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── migrations
│   ├── models.py
│   ├── tests.py
│   └── views.py
├── manage.py
├── meraki
│   ├── admin.py
│   ├── apps.py
│   ├── migrations
│   ├── models.py
│   ├── tests.py
│   └── views.py
├── openvuln
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── migrations
│   │   └── __init__.py
│   ├── models.py
│   ├── tests.py
│   └── views.py
└── sdwan
    ├── __init__.py
    ├── admin.py
    ├── apps.py
    ├── migrations
    ├── models.py
    ├── tests.py
    └── views.py
</code></pre></div></div><p>Add the openvuln app to <strong>settings.py</strong></p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Application definition
</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="s">'meraki'</span><span class="p">,</span> <span class="c1"># Added in previous post
</span>    <span class="s">'dcnm'</span><span class="p">,</span> <span class="c1"># Added in previous post
</span>    <span class="s">'sdwan'</span><span class="p">,</span> <span class="c1"># Added in previous post
</span>    <span class="s">'openvuln'</span><span class="p">,</span> <span class="c1"># &lt;- Add this
</span><span class="p">]</span>
</code></pre></div></div><hr /><h1 id="55-python-requests-functions"> <a href="#55-python-requests-functions" class="anchor-heading" aria-labelledby="55-python-requests-functions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.5 Python Requests Functions</h1><p>In the GitHub repository linked above, you’ll find code samples for curl, go, php, ruby, javascript.</p><p>There’s a python library available that can be installed via pip (<code class="language-plaintext highlighter-rouge">pip install openVulnQuery</code>).</p><p>In my case I’ve used the native python requests package.</p><p>Create the <code class="language-plaintext highlighter-rouge">Apps &gt; openvuln_api.py</code> file - this will store all our OpenVuln python functions.</p><p>Retrieving the access token:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_oauth_token</span><span class="p">(</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">,</span> <span class="n">request_token_url</span><span class="o">=</span><span class="s">"https://cloudsso.cisco.com/as/token.oauth2"</span><span class="p">):</span>
    <span class="s">"""Get OAuth2 token from api based on client id and secret.
    :param client_id: Client id stored in config file.
    :param client_secret: Client secret stored in config file.
    :param request_token_url: the POST URL to request a token response
    :return The valid access token to pass to api in header.
    :raise requests exhibits anything other than a 200 response.
    """</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">request_token_url</span> <span class="k">if</span> <span class="n">request_token_url</span> <span class="k">else</span> <span class="n">REQUEST_TOKEN_URL</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s">'client_id'</span><span class="p">:</span> <span class="n">client_id</span><span class="p">,</span> <span class="s">'client_secret'</span><span class="p">:</span> <span class="n">client_secret</span><span class="p">},</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">'grant_type'</span><span class="p">:</span> <span class="s">'client_credentials'</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span><span class="p">.</span><span class="n">json</span><span class="p">()[</span><span class="s">'access_token'</span><span class="p">]</span>

<span class="n">token</span> <span class="o">=</span> <span class="n">get_oauth_token</span><span class="p">(</span><span class="n">client_id</span><span class="o">=</span><span class="s">'&lt;your-id&gt;'</span><span class="p">,</span>
                        <span class="n">client_secret</span><span class="o">=</span><span class="s">'&lt;your-secret&gt;'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</code></pre></div></div><p>Run the function and pass in your client ID and Secret:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>venv<span class="o">)</span> % python openvuln_api.py
ENPFzXc7ja9IEmAF5GCLH9mnQO5z
</code></pre></div></div><p>Retrieve the latest 100 vulnerabilities:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">openvuln_http_get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">'https://api.cisco.com/security/advisories/latest/100'</span><span class="p">):</span>
    <span class="n">CLIENT_ID</span> <span class="o">=</span> <span class="s">"&lt;your-id&gt;"</span>
    <span class="n">CLIENT_SECRET</span> <span class="o">=</span> <span class="s">"&lt;your-token&gt;"</span>
    <span class="n">API_URL</span> <span class="o">=</span> <span class="s">"https://api.cisco.com/security/advisories"</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">get_oauth_token</span><span class="p">(</span><span class="n">client_id</span><span class="o">=</span><span class="n">CLIENT_ID</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="n">CLIENT_SECRET</span><span class="p">)</span> <span class="c1"># Get a Token
</span>    <span class="n">header</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Authorization'</span><span class="p">:</span> <span class="s">'Bearer {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">token</span><span class="p">),</span>
        <span class="s">'Accept'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'User-Agent'</span><span class="p">:</span> <span class="s">'openvuln_api'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="c1">#Network Device endpoint
</span>    <span class="n">querystring</span> <span class="o">=</span> <span class="s">''</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>  <span class="c1"># Make the Get Request
</span>    <span class="n">advisories</span> <span class="o">=</span> <span class="n">resp</span><span class="p">.</span><span class="n">json</span><span class="p">()</span> <span class="c1"># Capture data from the controller
</span>
    <span class="k">return</span> <span class="n">advisories</span><span class="p">,</span> <span class="n">resp</span><span class="p">.</span><span class="n">status_code</span>

<span class="n">psirts</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">openvuln_http_get</span><span class="p">()</span>
<span class="n">pp</span><span class="p">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">psirts</span><span class="p">)</span>
</code></pre></div></div><p>Run the function and check the output:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>venv<span class="o">)</span> % python openvuln_api.py

<span class="o">{</span><span class="s1">'advisories'</span>: <span class="o">[{</span><span class="s1">'advisoryId'</span>: <span class="s1">'cisco-sa-http-fp-bp-KfDdcQhc'</span>,
                 <span class="s1">'advisoryTitle'</span>: <span class="s1">'Multiple Cisco Products Snort HTTP '</span>
                                  <span class="s1">'Detection Engine File Policy Bypass '</span>
                                  <span class="s1">'Vulnerabilities'</span>,
                 <span class="s1">'bugIDs'</span>: <span class="o">[</span><span class="s1">'CSCvv70864'</span>,
                            <span class="s1">'CSCvw19272'</span>,
                            <span class="s1">'CSCvw26645'</span>,
                            <span class="s1">'CSCvw59055'</span><span class="o">]</span>,
                 <span class="s1">'cves'</span>: <span class="o">[</span><span class="s1">'CVE-2021-1494'</span>, <span class="s1">'CVE-2021-1495'</span><span class="o">]</span>,
                 <span class="s1">'cvrfUrl'</span>: <span class="s1">'https://tools.cisco.com/security/center/contentxml/CiscoSecurityAdvisory/cisco-sa-http-fp-bp-KfDdcQhc/cvrf/cisco-sa-http-fp-bp-KfDdcQhc_cvrf.xml'</span>,
                 <span class="s1">'cvssBaseScore'</span>: <span class="s1">'5.8'</span>,
                 <span class="s1">'cwe'</span>: <span class="o">[</span><span class="s1">'CWE-693'</span><span class="o">]</span>,
                 <span class="s1">'firstPublished'</span>: <span class="s1">'2021-04-28T16:00:00'</span>,
                 <span class="s1">'ipsSignatures'</span>: <span class="o">[</span><span class="s1">'NA'</span><span class="o">]</span>,
                 <span class="s1">'lastUpdated'</span>: <span class="s1">'2021-05-20T18:51:31'</span>,
                 <span class="s1">'productNames'</span>: <span class="o">[</span><span class="s1">'Cisco Firepower Threat Defense Software '</span>,
                                  <span class="s1">'Cisco UTD SNORT IPS Engine Software '</span>,
                                  <span class="o">]</span>,
                 <span class="s1">'publicationUrl'</span>: <span class="s1">'https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-http-fp-bp-KfDdcQhc'</span>,
                 <span class="s1">'sir'</span>: <span class="s1">'Medium'</span>,
                 <span class="s1">'status'</span>: <span class="s1">'Final'</span>,
                 <span class="s1">'summary'</span>: <span class="s1">'&lt;p&gt;&lt;span '</span>
                            <span class="s1">'id="ctl00_MainBodyContainer_DgFields_ctl03_lblField"&gt;Multiple '</span>
                            <span class="s1">'Cisco&amp;nbsp;products are affected by '</span>
                            <span class="s1">'vulnerabilities in the Snort detection engine '</span>
                            <span class="s1">'that&lt;/span&gt; could allow an unauthenticated, '</span>
                            <span class="s1">'remote attacker to bypass a configured file '</span>
                            <span class="s1">'policy for HTTP.&lt;/p&gt;\r\n'</span>
                            <span class="s1">'&lt;p&gt;These vulnerabilities are due to incorrect '</span>
                            <span class="s1">'handling of specific HTTP header parameters. An '</span>
                            <span class="s1">'attacker could exploit these vulnerabilities by '</span>
                            <span class="s1">'sending crafted HTTP packets through an affected '</span>
                            <span class="s1">'device. A successful exploit could allow the '</span>
                            <span class="s1">'attacker to bypass a configured file policy for '</span>
                            <span class="s1">'HTTP packets and deliver a malicious '</span>
                            <span class="s1">'payload.&lt;/p&gt;\r\n'</span>
                            <span class="s1">'&lt;p&gt;Cisco&amp;nbsp;has released software updates that '</span>
                            <span class="s1">'address these vulnerabilities. There are no '</span>
                            <span class="s1">'workarounds that address these '</span>
                            <span class="s1">'vulnerabilities.&amp;nbsp;&lt;/p&gt;\r\n'</span>
                            <span class="s1">'&lt;p&gt;This advisory is available at the following '</span>
                            <span class="s1">'link:&lt;br&gt;&lt;a '</span>
                            <span class="s1">'href="https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-http-fp-bp-KfDdcQhc" '</span>
                            <span class="s1">'rel="nofollow"&gt;https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-http-fp-bp-KfDdcQhc&lt;/a&gt;&lt;/p&gt;\r\n'</span>,
                 <span class="s1">'version'</span>: <span class="s1">'1.1'</span><span class="o">}</span>,
</code></pre></div></div><hr /><h1 id="56-django-models-file-and-database-definition"> <a href="#56-django-models-file-and-database-definition" class="anchor-heading" aria-labelledby="56-django-models-file-and-database-definition"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.6 Django Models file and Database Definition</h1><p>Edit our <strong>openvuln &gt; models.py</strong> file / database definition and create a model to store advisories:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="c1"># Create your models here.
</span><span class="k">class</span> <span class="nc">openvuln_advisory</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">advisoryId</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">advisoryTitle</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">bugIDs</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">cves</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">cvrfUrl</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">cvssBaseScore</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">cwe</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">firstPublished</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">ipsSignatures</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">lastUpdated</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">productNames</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">publicationUrl</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">sir</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">affected_devices</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">"no"</span><span class="p">)</span>
    <span class="n">last_updated</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">timezone</span><span class="p">.</span><span class="n">now</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">advisoryId</span>
</code></pre></div></div><p>Commit the model to postgres sql:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>venv<span class="o">)</span> % python manage.py makemigrations openvuln

Migrations <span class="k">for</span> <span class="s1">'openvuln'</span>:
  openvuln/migrations/0001_initial.py
    - Create model openvuln_advisory
<span class="o">(</span>venv<span class="o">)</span> % python manage.py migrate openvuln

Operations to perform:
  Apply all migrations: openvuln
</code></pre></div></div><h1 id="57-writing-to-database"> <a href="#57-writing-to-database" class="anchor-heading" aria-labelledby="57-writing-to-database"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.7 Writing to Database</h1><p>Create the below function to write our advisory request output to database:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># django imports
# Add your own path to django install location here
</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"/Users/jamespsullivan/Documents/grafana-cisco-demo/cisco_grafana/"</span><span class="p">)</span>
<span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">'DJANGO_SETTINGS_MODULE'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'cisco_grafana.settings'</span>

<span class="kn">import</span> <span class="nn">django</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pprint</span> <span class="k">as</span> <span class="n">pp</span>
<span class="n">django</span><span class="p">.</span><span class="n">setup</span><span class="p">()</span>

<span class="c1"># django openvuln model import
</span><span class="kn">from</span> <span class="nn">openvuln.models</span> <span class="kn">import</span> <span class="n">openvuln_advisory</span>

<span class="c1"># function to map JSON form API to DB model file and save
</span><span class="k">def</span> <span class="nf">advisories_to_db</span><span class="p">(</span><span class="n">advisories</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">advisory</span> <span class="ow">in</span> <span class="n">advisories</span><span class="p">[</span><span class="s">'advisories'</span><span class="p">]:</span>
        <span class="c1"># We want number values in this table column, convert NA to 0 value
</span>        <span class="k">if</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'cvssBaseScore'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'NA'</span><span class="p">:</span>
            <span class="n">advisory</span><span class="p">[</span><span class="s">'cvssBaseScore'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'0'</span>
        <span class="n">advisory_update</span> <span class="o">=</span> <span class="n">openvuln_advisory</span><span class="p">(</span>
            <span class="n">advisoryId</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'advisoryId'</span><span class="p">],</span>
            <span class="n">advisoryTitle</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'advisoryTitle'</span><span class="p">],</span>
            <span class="n">bugIDs</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'bugIDs'</span><span class="p">],</span>
            <span class="n">cves</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'cves'</span><span class="p">],</span>
            <span class="n">cvrfUrl</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'cvrfUrl'</span><span class="p">],</span>
            <span class="n">cvssBaseScore</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">advisory</span><span class="p">[</span><span class="s">'cvssBaseScore'</span><span class="p">]),</span>
            <span class="n">cwe</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'cwe'</span><span class="p">],</span>
            <span class="n">firstPublished</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'firstPublished'</span><span class="p">],</span>
            <span class="n">ipsSignatures</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'ipsSignatures'</span><span class="p">],</span>
            <span class="n">lastUpdated</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'lastUpdated'</span><span class="p">],</span>
            <span class="n">productNames</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'productNames'</span><span class="p">],</span>
            <span class="n">publicationUrl</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'publicationUrl'</span><span class="p">],</span>
            <span class="n">sir</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'sir'</span><span class="p">],</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'status'</span><span class="p">],</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="n">advisory</span><span class="p">[</span><span class="s">'summary'</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">advisory_update</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>

<span class="n">advisories_to_db</span><span class="p">(</span><span class="n">psirts</span><span class="p">)</span>
</code></pre></div></div><p>Verify that the advisories have been saved to database - you can use something like below, or pgAdmin as in previous tutorials.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">psirt</span> <span class="ow">in</span> <span class="n">openvuln_advisory</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">psirt</span><span class="p">.</span><span class="n">advisoryId</span> <span class="o">+</span> <span class="s">', '</span> <span class="o">+</span> <span class="n">psirt</span><span class="p">.</span><span class="n">advisoryTitle</span><span class="p">)</span>
</code></pre></div></div><p>Output looks ok?</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cisco-sa-sdwan-vmanageinfdis-LKrFpbv, Cisco SD-WAN vManage Information Disclosure Vulnerability
cisco-sa-snort-tfo-bypass-MmzZrtes, Multiple Cisco Products Snort TCP Fast Open File Policy Bypass Vulnerability
cisco-sa-20190515-nxos-cli-bypass, Cisco NX-OS Software CLI Bypass to Internal Service Vulnerability
cisco-sa-sb-wap-inject-Mp9FSdG, Cisco Small Business 100, 300, and 500 Series Wireless Access Points Command Injection Vulnerabilities
cisco-sa-finesse-strd-xss-bUKqffFW, Cisco Finesse Cross-Site Scripting Vulnerabilities
cisco-sa-dnasp-conn-cmdinj-HOj4YV5n, Cisco DNA Spaces Connector Command Injection Vulnerabilities
cisco-sa-dnasp-conn-prvesc-q6T6BzW, Cisco DNA Spaces Connector Privilege Escalation Vulnerabilities
cisco-sa-cml-cmd-inject-N4VYeQXB, Cisco Modeling Labs Web UI Command Injection Vulnerability
cisco-sa-hyperflex-rce-TjjNrkpR, Cisco HyperFlex HX Command Injection Vulnerabilities
cisco-sa-ucm-dos-OO4SRYEf, Cisco Hosted Collaboration Mediation Fulfillment Denial of Service Vulnerability
cisco-sa-anyconnect-mac-priv-esc-VqST2nrT, MacOS Local Privilege Escalation Exploitable through Cisco AnyConnect Secure Mobility Client
cisco-sa-openssl-2021-GHY28dJd, Multiple Vulnerabilities <span class="k">in </span>OpenSSL Affecting Cisco Products: March 2021
cisco-sa-waas-infdisc-Twb4EypK, Cisco Wide Area Application Services Software Information Disclosure Vulnerability
cisco-sa-vmanage-xss-eN75jxtW, Cisco SD-WAN vManage API Stored Cross-Site Scripting Vulnerability
cisco-sa-wsa-xss-mVjOWchB, Cisco Web Security Appliance Cross-Site Scripting Vulnerability
cisco-sa-ise-priv-esc-fNZX8hHj, Cisco Identity Services Engine Privilege Escalation Vulnerability
cisco-sa-ftd-ssl-decrypt-dos-DdyLuK6c, Cisco Firepower Threat Defense Software SSL Decryption Policy Denial of Service Vulnerability
cisco-sa-sdwan-buffover-MWGucjtO, Cisco SD-WAN vEdge Software Buffer Overflow Vulnerabilities
cisco-sa-sdwan-arbfile-7Qhd9mCn, Cisco SD-WAN Software Arbitrary File Corruption Vulnerability
cisco-sa-amp-imm-dll-tu79hvkO, Cisco Advanced Malware Protection <span class="k">for </span>Endpoints Windows Connector,  ClamAV <span class="k">for </span>Windows, and Immunet DLL Hijacking Vulnerability
cisco-sa-sdwan-dos-Ckn5cVqW, Cisco SD-WAN Software vDaemon Denial of Service Vulnerability
cisco-sa-sb-wap-multi-ZAfKGXhF, Cisco Small Business 100, 300, and 500 Series Wireless Access Points Vulnerabilities
cisco-sa-nfvis-cmdinj-DkFjqg2j, Cisco Enterprise NFV Infrastructure Software Command Injection Vulnerability
cisco-sa-sd-wan-vmanage-4TbynnhZ, Cisco SD-WAN vManage Software Vulnerabilities
</code></pre></div></div><p>Let’s add the following so we can categorise advisories by product family.</p><blockquote><p>Note: Initial intention here was to compare the software versions collected in our previous DCNM and SD-WAN articles to the <strong>Affected Releases</strong> for each advisory. Unfortunately, the API doesn’t seem to currently have a field that summarises impacted software versions. Some of the “Product Names” column reference versions, but not all… Maybe a feature request to include this in the future?</p></blockquote><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">psirt</span> <span class="ow">in</span> <span class="n">openvuln_advisory</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="nb">all</span><span class="p">():</span>
    <span class="k">if</span> <span class="s">'NX-OS'</span> <span class="ow">in</span> <span class="n">psirt</span><span class="p">.</span><span class="n">productNames</span><span class="p">:</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">devicesImpacted</span> <span class="o">=</span> <span class="s">'NX-OS'</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">elif</span> <span class="s">'SD-WAN'</span> <span class="ow">in</span> <span class="n">psirt</span><span class="p">.</span><span class="n">productNames</span><span class="p">:</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">devicesImpacted</span> <span class="o">=</span> <span class="s">'SD-WAN'</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">elif</span> <span class="s">'IOS'</span> <span class="ow">in</span> <span class="n">psirt</span><span class="p">.</span><span class="n">productNames</span><span class="p">:</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">devicesImpacted</span> <span class="o">=</span> <span class="s">'IOS XE/IOS'</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">elif</span> <span class="s">'Firepower'</span> <span class="ow">in</span> <span class="n">psirt</span><span class="p">.</span><span class="n">productNames</span><span class="p">:</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">devicesImpacted</span> <span class="o">=</span> <span class="s">'ASA/Firepower'</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">elif</span> <span class="s">'Unified Communications'</span> <span class="ow">in</span> <span class="n">psirt</span><span class="p">.</span><span class="n">productNames</span><span class="p">:</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">devicesImpacted</span> <span class="o">=</span> <span class="s">'Collab'</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">elif</span> <span class="s">'Jabber'</span> <span class="ow">in</span> <span class="n">psirt</span><span class="p">.</span><span class="n">productNames</span><span class="p">:</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">devicesImpacted</span> <span class="o">=</span> <span class="s">'Collab'</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">elif</span> <span class="s">'Webex'</span> <span class="ow">in</span> <span class="n">psirt</span><span class="p">.</span><span class="n">productNames</span><span class="p">:</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">devicesImpacted</span> <span class="o">=</span> <span class="s">'Collab'</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">elif</span> <span class="s">'HyperFlex'</span> <span class="ow">in</span> <span class="n">psirt</span><span class="p">.</span><span class="n">productNames</span><span class="p">:</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">devicesImpacted</span> <span class="o">=</span> <span class="s">'Hyperflex'</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">devicesImpacted</span> <span class="o">=</span> <span class="s">'other'</span>
        <span class="n">psirt</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div></div><hr /><h1 id="58-grafana"> <a href="#58-grafana" class="anchor-heading" aria-labelledby="58-grafana"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.8 Grafana</h1><ul><li>Create a new dashboard and add a new panel<li>Configure <strong>query options</strong> as below. We’ll query by the devicesImpacted field we created previously<li>Select PieChartv2 from the right, optionally change the PieChart type to <strong>donut</strong>, add the labels name, value and percent and give the chart a title.</ul><p>Your preview pane should now look like below - click save and apply <img src="https://github.com/j-sulliman/j-sulliman.github.io/blob/master/images/OpenVuln_Platforms_Impacted.png?raw=true" alt="Platforms Impacted" /></p><ul><li>Create a new panel to show advisories by severity and date<li>Time Column = <strong>firstPublished</strong><li>Metric Column = <strong>advisoryTitle</strong><li>From the select column select <strong>cvssBaseScore</strong><li>Select <strong>Bars</strong> from the right</ul><p>Your preview pane should now look like below - click save and apply <img src="https://github.com/j-sulliman/j-sulliman.github.io/blob/master/images/Advisories_by_date.png?raw=true" alt="Advisories By Date" /></p><p>Create a new panel to hold advisories detail table as below</p><ul><li>Time Column = <strong>firstPublished</strong><li>Add all relevant columns</ul><p>Your preview pane should now look like below - click save and apply. The publication URL provides a useful hyperlink to the advisory detail on tools.cisco.com. <img src="https://github.com/j-sulliman/j-sulliman.github.io/blob/master/images/Openvuln_Table.png?raw=true" alt="Advisories Table" /></p><h1 id="59-alerting-for-new-advisories"> <a href="#59-alerting-for-new-advisories" class="anchor-heading" aria-labelledby="59-alerting-for-new-advisories"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.9 Alerting for new Advisories</h1><p>Grafana has built in alerting capabilities:</p><blockquote><p>Grafana alerting allows you to attach rules to your dashboard panels. When you save the dashboard, Grafana extracts the alert rules into a separate alert rule storage and schedules them for evaluation.</p></blockquote><p>Let’s give it a try.</p><h2 id="591-smtp-settings-and-grafanaini"> <a href="#591-smtp-settings-and-grafanaini" class="anchor-heading" aria-labelledby="591-smtp-settings-and-grafanaini"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5.9.1 SMTP settings and Grafana.ini</h2><p>Edit grafana.ini to reflect the SMTP settings for your email account.</p><p>Note - I’m using Homebrew on mac, grafana.ini is as below - this will likely be different depending on your OS.</p><p><code class="language-plaintext highlighter-rouge">(venv) % nano /opt/homebrew/etc/grafana/grafana.ini</code></p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#################################### SMTP / Emailing ##########################
[smtp]
enabled = true
host = smtp.gmail.com:587
user = &lt;your-email&gt;@gmail.com
# If the password contains # or ; you have to wrap it with triple quotes. Ex """#password;"""
password = [**********]
;cert_file =
;key_file =
;skip_verify = false
from_address = admin@grafana.localhost
from_name = Grafana
# EHLO identity in SMTP dialog (defaults to instance_name)
;ehlo_identity = dashboard.example.com
# SMTP startTLS policy (defaults to 'OpportunisticStartTLS')
;startTLS_policy = NoStartTLS

[emails]
;welcome_email_on_sign_up = false
;templates_pattern = emails/*.html
</code></pre></div></div><p>Check the status of test email from Grafana’s alerting/ email test. In my case the test failed. No error message is given. But from grafana.log we see below io timeout: From <code class="language-plaintext highlighter-rouge">(venv) % tail /opt/homebrew/var/log/grafana/grafana.log</code></p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>venv<span class="o">)</span> % <span class="nb">tail</span> /opt/homebrew/var/log/grafana/grafana.log
<span class="nv">t</span><span class="o">=</span>2021-05-22T20:30:45+1200 <span class="nv">lvl</span><span class="o">=</span>eror <span class="nv">msg</span><span class="o">=</span><span class="s2">"failed to send notification"</span> <span class="nv">logger</span><span class="o">=</span>alerting.notifier <span class="nv">uid</span><span class="o">=</span> <span class="nv">error</span><span class="o">=</span><span class="s2">"Failed to send notification to email addresses: sulliman@gmail.com: dial tcp 74.125.24.109:587: i/o timeout"</span>
</code></pre></div></div><p>After allowing TCP 587 outbound on firewall and resending a test email:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">t</span><span class="o">=</span>2021-05-23T12:54:28+1200 <span class="nv">lvl</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">"Sending alert notification to"</span> <span class="nv">logger</span><span class="o">=</span>alerting.notifier.email <span class="nv">addresses</span><span class="o">=[</span>sulliman@gmail.com] <span class="nv">singleEmail</span><span class="o">=</span><span class="nb">false</span>
</code></pre></div></div><p>Test email received - <img src="https://github.com/j-sulliman/j-sulliman.github.io/blob/master/images/Grafana_test_notification.png?raw=true" alt="Test Notification" /></p><p>Edit the alert field of one of your graph panels. In this example, I’m checking for new alerts every 12 hours. If an advisory is published within the last 24 hours an email alert will be sent to the email address you’ve entered in the notifications channel.</p><p><img src="https://github.com/j-sulliman/j-sulliman.github.io/blob/master/images/Advisory_Alert.png?raw=true" alt="Advisory Alert" /></p><p>You’ll now receive alert notifications when new PSIRTS are detected. <img src="https://github.com/j-sulliman/j-sulliman.github.io/blob/master/images/PSIRT_Notification.png?raw=true" alt="New PSIRT Notification" /></p><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0">All content and views expressed here is my own and does not represent the views of my employer.</p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0 mr-2"> Page last modified: <span class="d-inline-block">May 23 2021 at 08:00 PM</span>.</p></div></footer></div></div></div>
